<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG Adventure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #1a1a2e;
            color: #fff;
            line-height: 1.6;
            background-image: linear-gradient(45deg, #0f3460 25%, transparent 25%), 
                              linear-gradient(-45deg, #0f3460 25%, transparent 25%), 
                              linear-gradient(45deg, transparent 75%, #0f3460 75%), 
                              linear-gradient(-45deg, transparent 75%, #0f3460 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        .game-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* –°—Ç–∞—Ç—É—Å –±–∞—Ä */
        .status-bar {
            background: #16213e;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            border: 2px solid #0f3460;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .player-info h2 {
            color: #e94560;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .stats {
            display: flex;
            gap: 15px;
        }

        .stat {
            text-align: center;
        }

        .health-bar, .mana-bar, .exp-bar {
            width: 100px;
            height: 10px;
            background: #333;
            border-radius: 5px;
            margin-top: 5px;
            overflow: hidden;
        }

        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #e94560);
        }

        .mana-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #4cc9f0);
        }

        .exp-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
        }

        /* –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å */
        .game-area {
            background: #16213e;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            min-height: 200px;
            border: 2px solid #0f3460;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .location {
            margin-bottom: 15px;
        }

        .location h3 {
            color: #4cc9f0;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .location p {
            margin-bottom: 10px;
        }

        /* –ë–æ–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ */
        .battle-area {
            background: #1e2a47;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #4cc9f0;
        }

        .enemy-info {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .enemy-icon {
            width: 60px;
            height: 60px;
            background: #e74c3c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 2px solid #fff;
        }

        .enemy-stats {
            flex-grow: 1;
        }

        .enemy-name {
            font-weight: bold;
            color: #e94560;
        }

        .enemy-health-bar {
            width: 100%;
            height: 12px;
            background: #333;
            border-radius: 6px;
            margin: 5px 0;
            overflow: hidden;
        }

        .enemy-health-fill {
            height: 100%;
            background: linear-gradient(90deg, #e74c3c, #e94560);
            transition: width 0.3s ease;
        }

        /* –î–µ–π—Å—Ç–≤–∏—è */
        .actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .action-btn {
            background: linear-gradient(145deg, #0f3460, #1e2a47);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            border: 1px solid #4cc9f0;
        }

        .action-btn:hover {
            background: linear-gradient(145deg, #e94560, #c0392b);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .action-btn:disabled {
            background: #333;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .spell-btn {
            background: linear-gradient(145deg, #8e44ad, #9b59b6);
            border-color: #9b59b6;
        }

        .spell-btn:hover {
            background: linear-gradient(145deg, #9b59b6, #8e44ad);
        }

        .battle-btn {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            border-color: #e94560;
        }

        /* –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π */
        .event-log {
            background: #0f3460;
            padding: 15px;
            border-radius: 10px;
            height: 150px;
            overflow-y: auto;
            font-size: 14px;
            border: 1px solid #4cc9f0;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid #e94560;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .log-entry.spell {
            border-left-color: #8e44ad;
        }

        .log-entry.quest {
            border-left-color: #f39c12;
        }

        .log-entry.danger {
            border-left-color: #e74c3c;
        }

        .log-entry.heal {
            border-left-color: #2ecc71;
        }

        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        .inventory {
            margin-top: 20px;
        }

        .inventory h3 {
            color: #4cc9f0;
            margin-bottom: 10px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .inventory-items {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .item {
            background: linear-gradient(145deg, #0f3460, #1e2a47);
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid #4cc9f0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .item:hover {
            background: linear-gradient(145deg, #e94560, #c0392b);
            transform: scale(1.05);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .item.usable {
            border-color: #2ecc71;
        }

        .item.consumable {
            border-color: #e74c3c;
        }

        /* –û—Å–∞–¥–∞ */
        .siege-info {
            background: linear-gradient(145deg, #e74c3c, #c0392b);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            text-align: center;
            animation: pulse 2s infinite;
            border: 1px solid #fff;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        /* –°–º–µ—Ä—Ç—å */
        .death-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .death-screen h2 {
            color: #e74c3c;
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        .death-screen p {
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .restart-btn {
            background: linear-gradient(145deg, #e94560, #c0392b);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s;
            border: 1px solid #fff;
        }

        .restart-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        /* –í–∏–∑—É–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è */
        .gold-counter {
            color: #f39c12;
            font-weight: bold;
        }

        .level-badge {
            background: #e94560;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-left: 5px;
        }

        .damage-text {
            color: #e74c3c;
            font-weight: bold;
            animation: pop 0.3s ease;
        }

        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        .heal-text {
            color: #2ecc71;
            font-weight: bold;
            animation: pop 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- –°—Ç–∞—Ç—É—Å –±–∞—Ä -->
        <div class="status-bar">
            <div class="player-info">
                <h2 id="player-name">–ò—Å–∫–∞—Ç–µ–ª—å –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–π</h2>
                <p>–£—Ä–æ–≤–µ–Ω—å: <span id="player-level">1</span> | –ó–æ–ª–æ—Ç–æ: <span class="gold-counter" id="player-gold">50</span></p>
            </div>
            <div class="stats">
                <div class="stat">
                    <div>‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</div>
                    <div class="health-bar">
                        <div class="health-fill" id="health-fill"></div>
                    </div>
                    <span id="health-text">100/100</span>
                </div>
                <div class="stat">
                    <div>üî∑ –ú–∞–Ω–∞</div>
                    <div class="mana-bar">
                        <div class="mana-fill" id="mana-fill"></div>
                    </div>
                    <span id="mana-text">50/50</span>
                </div>
                <div class="stat">
                    <div>‚≠ê –û–ø—ã—Ç</div>
                    <div class="exp-bar">
                        <div class="exp-fill" id="exp-fill"></div>
                    </div>
                    <span id="exp-text">0/100</span>
                </div>
            </div>
        </div>

        <!-- –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å -->
        <div class="game-area">
            <div id="siege-warning" class="siege-info" style="display: none;">
                ‚öîÔ∏è –î–ï–†–ï–í–ù–Ø –ü–û–î –û–°–ê–î–û–ô! –ó–∞—â–∏—Ç–∏—Ç–µ –∂–∏—Ç–µ–ª–µ–π! ‚öîÔ∏è
            </div>
            
            <div class="location" id="location">
                <h3>üè† –ù–∞—á–∞–ª—å–Ω–∞—è –¥–µ—Ä–µ–≤–Ω—è</h3>
                <p>–í—ã —Å—Ç–æ–∏—Ç–µ –≤ —Ü–µ–Ω—Ç—Ä–µ –º–∞–ª–µ–Ω—å–∫–æ–π –¥–µ—Ä–µ–≤–Ω–∏. –í–æ–∫—Ä—É–≥ –≤–∞—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–º–æ–≤ –∏ –º–∞–≥–∞–∑–∏–Ω.</p>
            </div>

            <!-- –ë–æ–µ–≤–∞—è –æ–±–ª–∞—Å—Ç—å -->
            <div id="battle-area" class="battle-area" style="display: none;">
                <div class="enemy-info">
                    <div class="enemy-icon" id="enemy-icon">üëπ</div>
                    <div class="enemy-stats">
                        <div class="enemy-name" id="enemy-name">–í—Ä–∞–≥</div>
                        <div class="enemy-health-bar">
                            <div class="enemy-health-fill" id="enemy-health-fill"></div>
                        </div>
                        <div id="enemy-health-text">100/100</div>
                    </div>
                </div>
            </div>
            
            <div class="actions" id="actions">
                <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –±—É–¥—É—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è JavaScript -->
            </div>

            <div class="inventory">
                <h3>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å (–∫–ª–∏–∫–∞–π—Ç–µ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)</h3>
                <div class="inventory-items" id="inventory">
                    <!-- –ü—Ä–µ–¥–º–µ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>
        </div>

        <!-- –õ–æ–≥ —Å–æ–±—ã—Ç–∏–π -->
        <div class="event-log" id="event-log">
            <div class="log-entry">üéÆ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ RPG –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ!</div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω —Å–º–µ—Ä—Ç–∏ -->
    <div id="death-screen" class="death-screen" style="display: none;">
        <h2>üíÄ –í–´ –£–ú–ï–†–õ–ò</h2>
        <p>–í–∞—à–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–¥–æ—à–ª–æ –∫ –∫–æ–Ω—Ü—É...</p>
        <p>–î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å: <span id="death-level">1</span></p>
        <p>–°–æ–±—Ä–∞–Ω–æ –∑–æ–ª–æ—Ç–∞: <span id="death-gold">0</span></p>
        <button class="restart-btn" onclick="restartGame()">üîÑ –ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
    </div>

    <script>
        // –ò–≥—Ä–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        const gameState = {
            player: {
                name: "–ò—Å–∫–∞—Ç–µ–ª—å –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–π",
                level: 1,
                health: 100,
                maxHealth: 100,
                mana: 50,
                maxMana: 50,
                experience: 0,
                nextLevelExp: 100,
                gold: 50,
                inventory: [
                    { name: "‚ù§Ô∏è –ú–∞–ª–æ–µ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è", type: "consumable", effect: { health: 30 } },
                    { name: "‚öîÔ∏è –ü—Ä–æ—Å—Ç–æ–π –º–µ—á", type: "weapon", damage: 10 }
                ],
                spells: [
                    { name: "üî• –û–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä", cost: 15, damage: 25, description: "–ù–∞–Ω–æ—Å–∏—Ç 25 —É—Ä–æ–Ω–∞ –æ–≥–Ω–µ–º" },
                    { name: "‚ú® –ò—Å—Ü–µ–ª–µ–Ω–∏–µ", cost: 20, heal: 35, description: "–í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç 35 –∑–¥–æ—Ä–æ–≤—å—è" },
                    { name: "‚ùÑÔ∏è –õ–µ–¥—è–Ω–∞—è —Å—Ç—Ä–µ–ª–∞", cost: 12, damage: 18, slow: true, description: "–ù–∞–Ω–æ—Å–∏—Ç 18 —É—Ä–æ–Ω–∞ –∏ –∑–∞–º–µ–¥–ª—è–µ—Ç –≤—Ä–∞–≥–∞" }
                ]
            },
            currentLocation: "village",
            currentBattle: null,
            siegeActive: false,
            siegeCounter: 0,
            merchantHappy: false,
            purchasesCount: 0,
            locations: {
                village: {
                    name: "üè† –ù–∞—á–∞–ª—å–Ω–∞—è –¥–µ—Ä–µ–≤–Ω—è",
                    description: "–í—ã —Å—Ç–æ–∏—Ç–µ –≤ —Ü–µ–Ω—Ç—Ä–µ –º–∞–ª–µ–Ω—å–∫–æ–π –¥–µ—Ä–µ–≤–Ω–∏. –í–æ–∫—Ä—É–≥ –≤–∞—Å –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–æ–º–æ–≤ –∏ –º–∞–≥–∞–∑–∏–Ω.",
                    actions: [
                        { text: "üå≤ –û—Ç–ø—Ä–∞–≤–∏—Ç—å—Å—è –≤ –ª–µ—Å", target: "forest", type: "travel" },
                        { text: "üõí –ó–∞–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω", target: "shop", type: "travel" },
                        { text: "üí¨ –ü–æ–≥–æ–≤–æ—Ä–∏—Ç—å —Å –∂–∏—Ç–µ–ª—è–º–∏", type: "dialogue" },
                        { text: "üõ°Ô∏è –ó–∞—â–∏—â–∞—Ç—å –¥–µ—Ä–µ–≤–Ω—é", type: "defend", requirements: { siege: true } }
                    ]
                },
                forest: {
                    name: "üå≤ –¢—ë–º–Ω—ã–π –ª–µ—Å",
                    description: "–í—ã –≤ –≥—É—Å—Ç–æ–º –ª–µ—Å—É. –°–ª—ã—à–Ω—ã —Å—Ç—Ä–∞–Ω–Ω—ã–µ –∑–≤—É–∫–∏...",
                    actions: [
                        { text: "üîç –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –ª–µ—Å", type: "explore" },
                        { text: "üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –¥–µ—Ä–µ–≤–Ω—é", target: "village", type: "travel" },
                        { text: "üéØ –û—Ö–æ—Ç–∏—Ç—å—Å—è –Ω–∞ –∑–≤–µ—Ä–µ–π", type: "hunt" },
                        { text: "üî• –û–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä (15 –º–∞–Ω—ã)", type: "spell", spell: 0, requirements: { mana: 15 } },
                        { text: "‚ú® –ò—Å—Ü–µ–ª–µ–Ω–∏–µ (20 –º–∞–Ω—ã)", type: "spell", spell: 1, requirements: { mana: 20 } }
                    ]
                },
                shop: {
                    name: "üõí –ú–∞–≥–∞–∑–∏–Ω —Ç–æ—Ä–≥–æ–≤—Ü–∞",
                    description: "–í—ã –≤ –º–∞–ª–µ–Ω—å–∫–æ–º –º–∞–≥–∞–∑–∏–Ω–µ. –¢–æ—Ä–≥–æ–≤–µ—Ü –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–≤–æ–∏ —Ç–æ–≤–∞—Ä—ã.",
                    actions: [
                        { text: "‚ù§Ô∏è –ö—É–ø–∏—Ç—å –º–∞–ª–æ–µ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è (10 –∑–æ–ª–æ—Ç–∞)", cost: 10, type: "buy", item: { name: "‚ù§Ô∏è –ú–∞–ª–æ–µ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è", type: "consumable", effect: { health: 30 } } },
                        { text: "üíñ –ö—É–ø–∏—Ç—å –±–æ–ª—å—à–æ–µ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è (25 –∑–æ–ª–æ—Ç–∞)", cost: 25, type: "buy", item: { name: "üíñ –ë–æ–ª—å—à–æ–µ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è", type: "consumable", effect: { health: 70 } } },
                        { text: "üî∑ –ö—É–ø–∏—Ç—å –∑–µ–ª—å–µ –º–∞–Ω—ã (15 –∑–æ–ª–æ—Ç–∞)", cost: 15, type: "buy", item: { name: "üî∑ –ú–∞–ª–æ–µ –∑–µ–ª—å–µ –º–∞–Ω—ã", type: "consumable", effect: { mana: 25 } } },
                        { text: "‚öîÔ∏è –ö—É–ø–∏—Ç—å —É–ª—É—á—à–µ–Ω–Ω—ã–π –º–µ—á (50 –∑–æ–ª–æ—Ç–∞)", cost: 50, type: "buy", item: { name: "‚öîÔ∏è –£–ª—É—á—à–µ–Ω–Ω—ã–π –º–µ—á", type: "weapon", damage: 20 } },
                        { text: "üíç –ö—É–ø–∏—Ç—å –∫–æ–ª—å—Ü–æ –º–∞–≥–∞ (40 –∑–æ–ª–æ—Ç–∞)", cost: 40, type: "buy", item: { name: "üíç –ö–æ–ª—å—Ü–æ –º–∞–≥–∞", type: "accessory", effect: { maxMana: 30 } } },
                        { text: "üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –¥–µ—Ä–µ–≤–Ω—é", target: "village", type: "travel" }
                    ]
                }
            },
            // –í—Ä–∞–≥–∏ –¥–ª—è –æ—Ö–æ—Ç—ã
            huntEnemies: [
                { name: "üê∫ –°–ª–∞–±—ã–π –≤–æ–ª–∫", health: 20, maxHealth: 20, damage: 5, exp: 10, gold: 5, icon: "üê∫" },
                { name: "üêó –ö–∞–±–∞–Ω", health: 35, maxHealth: 35, damage: 8, exp: 18, gold: 8, icon: "üêó" },
                { name: "üêª –ú–µ–¥–≤–µ–¥—å", health: 60, maxHealth: 60, damage: 15, exp: 35, gold: 15, icon: "üêª" },
                { name: "üëπ –õ–µ—Å–Ω–æ–π —Ç—Ä–æ–ª–ª—å", health: 80, maxHealth: 80, damage: 20, exp: 50, gold: 25, icon: "üëπ" }
            ],
            // –í—Ä–∞–≥–∏ –¥–ª—è –æ—Å–∞–¥—ã
            siegeEnemies: [
                { name: "üíÄ –ë–∞–Ω–¥–∏—Ç", health: 40, maxHealth: 40, damage: 10, exp: 20, gold: 10, icon: "üíÄ" },
                { name: "üó°Ô∏è –†–∞–∑–±–æ–π–Ω–∏–∫", health: 60, maxHealth: 60, damage: 15, exp: 30, gold: 15, icon: "üó°Ô∏è" },
                { name: "üë∫ –ì–æ–±–ª–∏–Ω", health: 30, maxHealth: 30, damage: 8, exp: 15, gold: 8, icon: "üë∫" },
                { name: "üëπ –û—Ä–∫", health: 80, maxHealth: 80, damage: 18, exp: 40, gold: 20, icon: "üëπ" },
                { name: "üëë –õ–∏–¥–µ—Ä –±–∞–Ω–¥–∏—Ç–æ–≤", health: 120, maxHealth: 120, damage: 25, exp: 80, gold: 50, icon: "üëë" }
            ]
        };

        // DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const elements = {
            playerName: document.getElementById('player-name'),
            playerLevel: document.getElementById('player-level'),
            playerGold: document.getElementById('player-gold'),
            healthFill: document.getElementById('health-fill'),
            healthText: document.getElementById('health-text'),
            manaFill: document.getElementById('mana-fill'),
            manaText: document.getElementById('mana-text'),
            expFill: document.getElementById('exp-fill'),
            expText: document.getElementById('exp-text'),
            location: document.getElementById('location'),
            actions: document.getElementById('actions'),
            inventory: document.getElementById('inventory'),
            eventLog: document.getElementById('event-log'),
            siegeWarning: document.getElementById('siege-warning'),
            deathScreen: document.getElementById('death-screen'),
            deathLevel: document.getElementById('death-level'),
            deathGold: document.getElementById('death-gold'),
            battleArea: document.getElementById('battle-area'),
            enemyIcon: document.getElementById('enemy-icon'),
            enemyName: document.getElementById('enemy-name'),
            enemyHealthFill: document.getElementById('enemy-health-fill'),
            enemyHealthText: document.getElementById('enemy-health-text')
        };

        // –§—É–Ω–∫—Ü–∏–∏ –∏–≥—Ä—ã
        function updateUI() {
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
            const player = gameState.player;
            elements.playerName.textContent = player.name;
            elements.playerLevel.textContent = player.level;
            elements.playerGold.textContent = player.gold;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–¥–æ—Ä–æ–≤—å–µ
            const healthPercent = (player.health / player.maxHealth) * 100;
            elements.healthFill.style.width = healthPercent + '%';
            elements.healthText.textContent = player.health + '/' + player.maxHealth;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞–Ω—É
            const manaPercent = (player.mana / player.maxMana) * 100;
            elements.manaFill.style.width = manaPercent + '%';
            elements.manaText.textContent = player.mana + '/' + player.maxMana;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ–ø—ã—Ç
            const expPercent = (player.experience / player.nextLevelExp) * 100;
            elements.expFill.style.width = expPercent + '%';
            elements.expText.textContent = player.experience + '/' + player.nextLevelExp;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
            updateInventory();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–º–µ—Ä—Ç—å
            if (player.health <= 0) {
                showDeathScreen();
            }
        }

        function updateLocation() {
            const location = gameState.locations[gameState.currentLocation];
            elements.location.innerHTML = `
                <h3>${location.name}</h3>
                <p>${location.description}</p>
            `;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–± –æ—Å–∞–¥–µ
            if (gameState.siegeActive && gameState.currentLocation === "village") {
                elements.siegeWarning.style.display = 'block';
            } else {
                elements.siegeWarning.style.display = 'none';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∏–∞–ª–æ–≥ —Ç–æ—Ä–≥–æ–≤—Ü–∞
            if (gameState.currentLocation === "shop" && gameState.merchantHappy) {
                elements.location.innerHTML += `<p><em>–¢–æ—Ä–≥–æ–≤–µ—Ü —É–ª—ã–±–∞–µ—Ç—Å—è: "–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫–∏! –ë–∏–∑–Ω–µ—Å –∏–¥–µ—Ç –æ—Ç–ª–∏—á–Ω–æ!"</em></p>`;
            }
            
            // –û—á–∏—â–∞–µ–º –∏ —Å–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
            elements.actions.innerHTML = '';
            location.actions.forEach(action => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è
                if (action.requirements) {
                    if (action.requirements.siege && !gameState.siegeActive) {
                        return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ
                    }
                    if (action.requirements.mana && gameState.player.mana < action.requirements.mana) {
                        return; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞–Ω—ã
                    }
                }
                
                const button = document.createElement('button');
                button.className = 'action-btn';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π
                if (action.type === 'spell') {
                    button.classList.add('spell-btn');
                }
                if (action.type === 'hunt' || action.type === 'defend') {
                    button.classList.add('battle-btn');
                }
                
                button.textContent = action.text;
                button.onclick = () => handleAction(action);
                
                // –û—Ç–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –ø–æ–∫—É–ø–∫–∏, –µ—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞
                if (action.type === 'buy' && gameState.player.gold < action.cost) {
                    button.disabled = true;
                }
                
                elements.actions.appendChild(button);
            });
        }

        function updateBattleUI(enemy) {
            if (!enemy) {
                elements.battleArea.style.display = 'none';
                return;
            }
            
            elements.battleArea.style.display = 'block';
            elements.enemyIcon.textContent = enemy.icon;
            elements.enemyName.textContent = enemy.name;
            
            const healthPercent = (enemy.health / enemy.maxHealth) * 100;
            elements.enemyHealthFill.style.width = healthPercent + '%';
            elements.enemyHealthText.textContent = enemy.health + '/' + enemy.maxHealth;
        }

        function updateInventory() {
            elements.inventory.innerHTML = '';
            gameState.player.inventory.forEach((item, index) => {
                const itemElement = document.createElement('div');
                itemElement.className = 'item';
                
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
                if (item.type === 'consumable') {
                    itemElement.classList.add('consumable');
                } else if (item.type === 'weapon') {
                    itemElement.classList.add('usable');
                }
                
                itemElement.textContent = item.name;
                itemElement.onclick = () => useItem(index);
                elements.inventory.appendChild(itemElement);
            });
        }

        function useItem(itemIndex) {
            const item = gameState.player.inventory[itemIndex];
            const player = gameState.player;
            
            switch(item.type) {
                case 'consumable':
                    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∞ (–∑–µ–ª—å—è)
                    if (item.effect.health) {
                        const healAmount = item.effect.health;
                        const newHealth = Math.min(player.health + healAmount, player.maxHealth);
                        const actualHeal = newHealth - player.health;
                        
                        player.health = newHealth;
                        gameState.player.inventory.splice(itemIndex, 1); // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
                        
                        addLogEntry(`–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ ${item.name} –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ ${actualHeal} –∑–¥–æ—Ä–æ–≤—å—è!`, "heal");
                    }
                    
                    if (item.effect.mana) {
                        const manaAmount = item.effect.mana;
                        const newMana = Math.min(player.mana + manaAmount, player.maxMana);
                        const actualMana = newMana - player.mana;
                        
                        player.mana = newMana;
                        gameState.player.inventory.splice(itemIndex, 1); // –£–¥–∞–ª—è–µ–º –ø—Ä–µ–¥–º–µ—Ç –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
                        
                        addLogEntry(`–í—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ ${item.name} –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ ${actualMana} –º–∞–Ω—ã!`, "spell");
                    }
                    break;
                    
                case 'weapon':
                    // –û–¥–µ–≤–∞–Ω–∏–µ –æ—Ä—É–∂–∏—è (–≤ —ç—Ç–æ–π –ø—Ä–æ—Å—Ç–æ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ)
                    addLogEntry(`–í—ã —ç–∫–∏–ø–∏—Ä–æ–≤–∞–ª–∏ ${item.name}. –£—Ä–æ–Ω: ${item.damage}`);
                    break;
                    
                case 'accessory':
                    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞–∫—Å–µ—Å—Å—É–∞—Ä–∞
                    if (item.effect.maxMana) {
                        player.maxMana += item.effect.maxMana;
                        player.mana = player.maxMana; // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∞–Ω—É –ø–æ–ª–Ω–æ—Å—Ç—å—é
                        gameState.player.inventory.splice(itemIndex, 1);
                        addLogEntry(`–í—ã –Ω–∞–¥–µ–ª–∏ ${item.name}. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –º–∞–Ω–∞ —É–≤–µ–ª–∏—á–µ–Ω–∞ –Ω–∞ ${item.effect.maxMana}!`, "spell");
                    }
                    break;
                    
                default:
                    addLogEntry(`–í—ã –Ω–µ –∑–Ω–∞–µ—Ç–µ, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ${item.name}.`);
                    break;
            }
            
            updateUI();
        }

        function addLogEntry(message, type = "normal") {
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            if (type === "spell") {
                logEntry.classList.add('spell');
            } else if (type === "quest") {
                logEntry.classList.add('quest');
            } else if (type === "danger") {
                logEntry.classList.add('danger');
            } else if (type === "heal") {
                logEntry.classList.add('heal');
            }
            
            logEntry.textContent = message;
            elements.eventLog.appendChild(logEntry);
            elements.eventLog.scrollTop = elements.eventLog.scrollHeight;
        }

        function handleAction(action) {
            switch(action.type) {
                case 'travel':
                    // –ü—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –≤ –¥–µ—Ä–µ–≤–Ω—é –µ—Å—Ç—å —à–∞–Ω—Å –Ω–∞—á–∞—Ç—å –æ—Å–∞–¥—É
                    if (action.target === "village" && !gameState.siegeActive && Math.random() < 0.3) {
                        startSiege();
                    }
                    
                    gameState.currentLocation = action.target;
                    updateLocation();
                    addLogEntry(`–í—ã –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª–∏—Å—å –≤ –Ω–æ–≤—É—é –ª–æ–∫–∞—Ü–∏—é.`);
                    break;
                    
                case 'explore':
                    const exploreEvents = [
                        "–í—ã –Ω–∞—à–ª–∏ 5 –∑–æ–ª–æ—Ç—ã—Ö –º–æ–Ω–µ—Ç!",
                        "–í—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–≥–æ –µ–Ω–æ—Ç–∞.",
                        "–ù–∏—á–µ–≥–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–≥–æ –Ω–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ.",
                        "–í—ã –Ω–∞—à–ª–∏ —Å—Ç—Ä–∞–Ω–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç."
                    ];
                    const randomEvent = exploreEvents[Math.floor(Math.random() * exploreEvents.length)];
                    addLogEntry(randomEvent);
                    
                    if (randomEvent.includes("–∑–æ–ª–æ—Ç—ã—Ö")) {
                        gameState.player.gold += 5;
                        addLogEntry("+5 –∑–æ–ª–æ—Ç–∞!");
                    }
                    break;
                    
                case 'hunt':
                    startBattle("hunt");
                    break;
                    
                case 'spell':
                    castSpell(action.spell);
                    break;
                    
                case 'buy':
                    if (gameState.player.gold >= action.cost) {
                        gameState.player.gold -= action.cost;
                        gameState.player.inventory.push(action.item);
                        gameState.purchasesCount++;
                        
                        // –ï—Å–ª–∏ –∫—É–ø–∏–ª–∏ 3 —Ç–æ–≤–∞—Ä–∞, —Ç–æ—Ä–≥–æ–≤–µ—Ü —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å—á–∞—Å—Ç–ª–∏–≤—ã–º
                        if (gameState.purchasesCount >= 3 && !gameState.merchantHappy) {
                            gameState.merchantHappy = true;
                            addLogEntry("–¢–æ—Ä–≥–æ–≤–µ—Ü —Ä–∞–¥–æ—Å—Ç–Ω–æ —É–ª—ã–±–∞–µ—Ç—Å—è: '–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫–∏! –ë–∏–∑–Ω–µ—Å –ø–æ—à–µ–ª –≤ –≥–æ—Ä—É!'", "quest");
                        }
                        
                        addLogEntry(`–í—ã –∫—É–ø–∏–ª–∏: ${action.item.name}`);
                        updateUI();
                        updateLocation(); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏, —Ç.–∫. –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–æ–ª–æ—Ç–∞ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
                    } else {
                        addLogEntry("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–æ–ª–æ—Ç–∞!");
                    }
                    break;
                    
                case 'dialogue':
                    let dialogue;
                    if (gameState.merchantHappy) {
                        dialogue = "–¢–æ—Ä–≥–æ–≤–µ—Ü –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç –≤–∞—Å: '–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç–µ –º–æ–π –±–∏–∑–Ω–µ—Å!'";
                    } else if (gameState.purchasesCount > 0) {
                        dialogue = "–¢–æ—Ä–≥–æ–≤–µ—Ü —Å –Ω–∞–¥–µ–∂–¥–æ–π —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –≤–∞—Å: '–ù–∞–¥–µ—é—Å—å, –±–∏–∑–Ω–µ—Å –Ω–∞–ª–∞–¥–∏—Ç—Å—è...'";
                    } else {
                        dialogue = "–¢–æ—Ä–≥–æ–≤–µ—Ü –∂–∞–ª—É–µ—Ç—Å—è: '–ü–ª–æ—Ö–∏–µ –ø—Ä–æ–¥–∞–∂–∏ –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è...'";
                    }
                    addLogEntry(dialogue);
                    break;
                    
                case 'defend':
                    startBattle("siege");
                    break;
                    
                default:
                    addLogEntry("–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ.");
                    break;
            }
            
            updateUI();
        }

        function startBattle(type) {
            let enemy;
            if (type === "hunt") {
                enemy = {...gameState.huntEnemies[Math.floor(Math.random() * gameState.huntEnemies.length)]};
            } else if (type === "siege") {
                enemy = {...gameState.siegeEnemies[Math.floor(Math.random() * gameState.siegeEnemies.length)]};
            }
            
            gameState.currentBattle = {
                enemy: enemy,
                type: type
            };
            
            addLogEntry(`–í—ã –≤—Å—Ç—Ä–µ—Ç–∏–ª–∏ ${enemy.name}!`, "danger");
            updateBattleUI(enemy);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±–æ–µ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
            elements.actions.innerHTML = '';
            
            const attackBtn = document.createElement('button');
            attackBtn.className = 'action-btn battle-btn';
            attackBtn.textContent = '‚öîÔ∏è –ê—Ç–∞–∫–æ–≤–∞—Ç—å';
            attackBtn.onclick = () => playerAttack();
            elements.actions.appendChild(attackBtn);
            
            const spellBtn = document.createElement('button');
            spellBtn.className = 'action-btn spell-btn';
            spellBtn.textContent = 'üîÆ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ';
            spellBtn.onclick = () => showSpells();
            elements.actions.appendChild(spellBtn);
            
            const itemBtn = document.createElement('button');
            itemBtn.className = 'action-btn';
            itemBtn.textContent = 'üéí –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç';
            itemBtn.onclick = () => showBattleItems();
            elements.actions.appendChild(itemBtn);
            
            const fleeBtn = document.createElement('button');
            fleeBtn.className = 'action-btn';
            fleeBtn.textContent = 'üèÉ –ë–µ–∂–∞—Ç—å';
            fleeBtn.onclick = () => fleeBattle();
            elements.actions.appendChild(fleeBtn);
        }

        function playerAttack() {
            const battle = gameState.currentBattle;
            const player = gameState.player;
            const enemy = battle.enemy;
            
            // –ò–≥—Ä–æ–∫ –∞—Ç–∞–∫—É–µ—Ç
            const playerDamage = 10 + (player.level * 2); // –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–Ω + –±–æ–Ω—É—Å —É—Ä–æ–≤–Ω—è
            enemy.health -= playerDamage;
            
            addLogEntry(`–í—ã –∞—Ç–∞–∫—É–µ—Ç–µ –∏ –Ω–∞–Ω–æ—Å–∏—Ç–µ ${playerDamage} —É—Ä–æ–Ω–∞ ${enemy.name}!`);
            updateBattleUI(enemy);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–±–µ–∂–¥–µ–Ω –ª–∏ –≤—Ä–∞–≥
            if (enemy.health <= 0) {
                endBattle(true);
                return;
            }
            
            // –í—Ä–∞–≥ –∞—Ç–∞–∫—É–µ—Ç
            addLogEntry(`${enemy.name} –∞—Ç–∞–∫—É–µ—Ç –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${enemy.damage} —É—Ä–æ–Ω–∞!`);
            player.health -= enemy.damage;
            
            updateUI();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–º–µ—Ä—Ç—å –∏–≥—Ä–æ–∫–∞
            if (player.health <= 0) {
                endBattle(false);
            }
        }

        function castSpellInBattle(spellIndex) {
            const battle = gameState.currentBattle;
            const player = gameState.player;
            const enemy = battle.enemy;
            const spell = player.spells[spellIndex];
            
            if (player.mana < spell.cost) {
                addLogEntry("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è!");
                return;
            }
            
            player.mana -= spell.cost;
            addLogEntry(`–í—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ "${spell.name}"!`, "spell");
            
            if (spell.damage) {
                enemy.health -= spell.damage;
                addLogEntry(`–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –Ω–∞–Ω–æ—Å–∏—Ç ${spell.damage} —É—Ä–æ–Ω–∞ ${enemy.name}!`);
                updateBattleUI(enemy);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–æ–±–µ–∂–¥–µ–Ω –ª–∏ –≤—Ä–∞–≥
                if (enemy.health <= 0) {
                    endBattle(true);
                    return;
                }
            }
            
            if (spell.heal) {
                const newHealth = Math.min(player.health + spell.heal, player.maxHealth);
                const actualHeal = newHealth - player.health;
                player.health = newHealth;
                addLogEntry(`–í—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ ${actualHeal} –∑–¥–æ—Ä–æ–≤—å—è!`, "heal");
            }
            
            // –í—Ä–∞–≥ –∞—Ç–∞–∫—É–µ—Ç
            addLogEntry(`${enemy.name} –∞—Ç–∞–∫—É–µ—Ç –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${enemy.damage} —É—Ä–æ–Ω–∞!`);
            player.health -= enemy.damage;
            
            updateUI();
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–º–µ—Ä—Ç—å –∏–≥—Ä–æ–∫–∞
            if (player.health <= 0) {
                endBattle(false);
            }
        }

        function showSpells() {
            elements.actions.innerHTML = '';
            
            gameState.player.spells.forEach((spell, index) => {
                const spellBtn = document.createElement('button');
                spellBtn.className = 'action-btn spell-btn';
                spellBtn.textContent = `${spell.name} (${spell.cost} –º–∞–Ω—ã)`;
                spellBtn.onclick = () => castSpellInBattle(index);
                
                if (gameState.player.mana < spell.cost) {
                    spellBtn.disabled = true;
                }
                
                elements.actions.appendChild(spellBtn);
            });
            
            const backBtn = document.createElement('button');
            backBtn.className = 'action-btn';
            backBtn.textContent = '‚¨ÖÔ∏è –ù–∞–∑–∞–¥';
            backBtn.onclick = () => startBattle(gameState.currentBattle.type);
            elements.actions.appendChild(backBtn);
        }

        function showBattleItems() {
            elements.actions.innerHTML = '';
            
            gameState.player.inventory.forEach((item, index) => {
                const itemBtn = document.createElement('button');
                itemBtn.className = 'action-btn';
                itemBtn.textContent = item.name;
                itemBtn.onclick = () => {
                    useItem(index);
                    // –ü–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–µ–¥–º–µ—Ç–∞ –≤—Ä–∞–≥ –∞—Ç–∞–∫—É–µ—Ç
                    const battle = gameState.currentBattle;
                    const player = gameState.player;
                    const enemy = battle.enemy;
                    
                    addLogEntry(`${enemy.name} –∞—Ç–∞–∫—É–µ—Ç –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${enemy.damage} —É—Ä–æ–Ω–∞!`);
                    player.health -= enemy.damage;
                    
                    updateUI();
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–º–µ—Ä—Ç—å –∏–≥—Ä–æ–∫–∞
                    if (player.health <= 0) {
                        endBattle(false);
                    } else {
                        startBattle(gameState.currentBattle.type);
                    }
                };
                elements.actions.appendChild(itemBtn);
            });
            
            const backBtn = document.createElement('button');
            backBtn.className = 'action-btn';
            backBtn.textContent = '‚¨ÖÔ∏è –ù–∞–∑–∞–¥';
            backBtn.onclick = () => startBattle(gameState.currentBattle.type);
            elements.actions.appendChild(backBtn);
        }

        function fleeBattle() {
            const battle = gameState.currentBattle;
            const enemy = battle.enemy;
            
            addLogEntry(`–í—ã —Å–±–µ–∂–∞–ª–∏ –æ—Ç ${enemy.name}!`);
            endBattle(false);
        }

        function endBattle(victory) {
            const battle = gameState.currentBattle;
            const enemy = battle.enemy;
            const player = gameState.player;
            
            if (victory) {
                let expReward = enemy.exp;
                let goldReward = enemy.gold;
                
                // –î–≤–æ–π–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ –∑–∞—â–∏—Ç—É –¥–µ—Ä–µ–≤–Ω–∏
                if (battle.type === "siege") {
                    expReward *= 2;
                    goldReward *= 2;
                }
                
                addLogEntry(`–í—ã –ø–æ–±–µ–¥–∏–ª–∏ ${enemy.name} –∏ –ø–æ–ª—É—á–∏–ª–∏ ${expReward} –æ–ø—ã—Ç–∞ –∏ ${goldReward} –∑–æ–ª–æ—Ç–∞!`, "quest");
                addExperience(expReward);
                player.gold += goldReward;
                
                // –î–ª—è –æ—Å–∞–¥—ã —É–º–µ–Ω—å—à–∞–µ–º —Å—á–µ—Ç—á–∏–∫
                if (battle.type === "siege") {
                    gameState.siegeCounter--;
                    
                    if (gameState.siegeCounter <= 0) {
                        endSiege();
                    }
                }
            }
            
            gameState.currentBattle = null;
            updateBattleUI(null);
            updateLocation();
            updateUI();
        }

        function castSpell(spellIndex) {
            const spell = gameState.player.spells[spellIndex];
            const player = gameState.player;
            
            if (player.mana < spell.cost) {
                addLogEntry("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–∞–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è!");
                return;
            }
            
            player.mana -= spell.cost;
            addLogEntry(`–í—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–µ "${spell.name}"!`, "spell");
            
            if (spell.damage) {
                // –ù–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω —Å–ª—É—á–∞–π–Ω–æ–º—É –≤—Ä–∞–≥—É (–≤–Ω–µ –±–æ—è)
                const enemy = gameState.huntEnemies[Math.floor(Math.random() * gameState.huntEnemies.length)];
                addLogEntry(`–ó–∞–∫–ª–∏–Ω–∞–Ω–∏–µ –Ω–∞–Ω–æ—Å–∏—Ç ${spell.damage} —É—Ä–æ–Ω–∞ ${enemy.name}!`);
                
                // –ü–æ–ª—É—á–∞–µ–º –æ–ø—ã—Ç –∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è
                addExperience(5);
            }
            
            if (spell.heal) {
                const newHealth = Math.min(player.health + spell.heal, player.maxHealth);
                const actualHeal = newHealth - player.health;
                player.health = newHealth;
                addLogEntry(`–í—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ ${actualHeal} –∑–¥–æ—Ä–æ–≤—å—è!`, "heal");
            }
            
            updateUI();
        }

        function startSiege() {
            gameState.siegeActive = true;
            gameState.siegeCounter = 3; // –ù—É–∂–Ω–æ –ø–æ–±–µ–¥–∏—Ç—å 3 –≤–æ–ª–Ω—ã –≤—Ä–∞–≥–æ–≤
            addLogEntry("üö® –¢–†–ï–í–û–ì–ê! –î–µ—Ä–µ–≤–Ω—è –ø–æ–¥–≤–µ—Ä–≥–ª–∞—Å—å –Ω–∞–ø–∞–¥–µ–Ω–∏—é –±–∞–Ω–¥–∏—Ç–æ–≤! –ó–∞—â–∏—Ç–∏—Ç–µ –∂–∏—Ç–µ–ª–µ–π!", "danger");
            updateLocation();
        }

        function endSiege() {
            gameState.siegeActive = false;
            addLogEntry("üéâ –ü–û–ë–ï–î–ê! –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—â–∏—Ç–∏–ª–∏ –¥–µ—Ä–µ–≤–Ω—é –æ—Ç –±–∞–Ω–¥–∏—Ç–æ–≤! –ñ–∏—Ç–µ–ª–∏ –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏!", "quest");
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞ –∑–∞ –∑–∞—â–∏—Ç—É –¥–µ—Ä–µ–≤–Ω–∏
            gameState.player.gold += 100;
            addExperience(50);
            addLogEntry("–ñ–∏—Ç–µ–ª–∏ –¥–µ—Ä–µ–≤–Ω–∏ –≤ –∑–Ω–∞–∫ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –ø–æ–¥–∞—Ä–∏–ª–∏ –≤–∞–º 100 –∑–æ–ª–æ—Ç–∞!", "quest");
            
            updateLocation();
        }

        function addExperience(exp) {
            if (exp > 0) {
                gameState.player.experience += exp;
                addLogEntry(`–ü–æ–ª—É—á–µ–Ω–æ –æ–ø—ã—Ç–∞: ${exp}`);
                
                if (gameState.player.experience >= gameState.player.nextLevelExp) {
                    levelUp();
                }
            }
            
            updateUI();
        }

        function levelUp() {
            const player = gameState.player;
            player.level++;
            player.experience -= player.nextLevelExp;
            player.nextLevelExp = Math.floor(player.nextLevelExp * 1.5);
            player.maxHealth += 20;
            player.health = player.maxHealth;
            player.maxMana += 10;
            player.mana = player.maxMana;
            
            addLogEntry(`üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —É—Ä–æ–≤–Ω—è ${player.level}!`, "quest");
            
            // –ï—Å–ª–∏ –æ—Å—Ç–∞–ª—Å—è –æ–ø—ã—Ç –ø–æ—Å–ª–µ –ø–æ–≤—ã—à–µ–Ω–∏—è —É—Ä–æ–≤–Ω—è, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –ø–æ–≤—ã—à–∞—Ç—å
            if (player.experience >= player.nextLevelExp) {
                levelUp();
            }
        }

        function showDeathScreen() {
            elements.deathLevel.textContent = gameState.player.level;
            elements.deathGold.textContent = gameState.player.gold;
            elements.deathScreen.style.display = 'flex';
        }

        function restartGame() {
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
            gameState.player = {
                name: "–ò—Å–∫–∞—Ç–µ–ª—å –ü—Ä–∏–∫–ª—é—á–µ–Ω–∏–π",
                level: 1,
                health: 100,
                maxHealth: 100,
                mana: 50,
                maxMana: 50,
                experience: 0,
                nextLevelExp: 100,
                gold: 50,
                inventory: [
                    { name: "‚ù§Ô∏è –ú–∞–ª–æ–µ –∑–µ–ª—å–µ –∑–¥–æ—Ä–æ–≤—å—è", type: "consumable", effect: { health: 30 } },
                    { name: "‚öîÔ∏è –ü—Ä–æ—Å—Ç–æ–π –º–µ—á", type: "weapon", damage: 10 }
                ],
                spells: gameState.player.spells // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è
            };
            
            gameState.currentLocation = "village";
            gameState.currentBattle = null;
            gameState.siegeActive = false;
            gameState.siegeCounter = 0;
            gameState.merchantHappy = false;
            gameState.purchasesCount = 0;
            
            elements.deathScreen.style.display = 'none';
            updateBattleUI(null);
            
            // –û—á–∏—â–∞–µ–º –ª–æ–≥
            elements.eventLog.innerHTML = '<div class="log-entry">‚ú® –í—ã –≤–æ—Å–∫—Ä–µ—Å–ª–∏ –∏ –Ω–∞—á–∞–ª–∏ –Ω–æ–≤–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ!</div>';
            
            updateUI();
            updateLocation();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function initGame() {
            updateUI();
            updateLocation();
            addLogEntry("üéÆ –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –ò—Å—Å–ª–µ–¥—É–π—Ç–µ –º–∏—Ä –∏ –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –∑–∞–¥–∞–Ω–∏—è.");
            addLogEntry("üí° –ü–æ–¥—Å–∫–∞–∑–∫–∞: –∫–ª–∏–∫–∞–π—Ç–µ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç—ã –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö!");
        }

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = initGame;
    </script>
</body>
</html>